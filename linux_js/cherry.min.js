/*! cherry v1.0.0 | (c) 2019 Overbool |  */
"use strict"; function grin(t) { var e; if (t = " " + t + " ", !document.getElementById("comment") || "textarea" != document.getElementById("comment").type) return !1; if (e = document.getElementById("comment"), document.selection) e.focus(), sel = document.selection.createRange(), sel.text = t, e.focus(); else if (e.selectionStart || "0" == e.selectionStart) { var o = e.selectionStart, r = e.selectionEnd, n = r; e.value = e.value.substring(0, o) + t + e.value.substring(r, e.value.length), n += t.length, e.focus(), e.selectionStart = n, e.selectionEnd = n } else e.value += t, e.focus() } $(function () { $(document).on("click", ".btn-login", function () { $(".login-wrap").iziModal("open"), $(".tab-nav").tab() }), $(document).on("submit", ".form-login", function (t) { t.preventDefault(), $(".form-login-submit").text(cherryAjax.loadingMsg), $.ajax({ type: "POST", dataType: "json", url: cherryAjax.ajaxUrl, data: $(".form-login").serialize() + "&action=ajaxLogin", success: function (t) { t.code ? ($(".login-wrap").iziModal("close"), $.toast({ text: "登陆成功，正在跳转...", icon: "success", position: "top-center", hideAfter: 1e3 }), document.location.reload()) : $.toast({ text: t.msg, icon: "error", position: "top-center", hideAfter: 1e3 }) }, error: function (t) { console.log("error: ", t), t.msg ? $.toast({ text: t.msg, icon: "error", position: "top-center", hideAfter: 1e3 }) : $.toast({ text: "错误的请求", icon: "error", position: "top-center", hideAfter: 1e3 }) } }) }), $(document).on("submit", ".form-register", function (t) { t.preventDefault(), $(".form-register-submit").text(cherryAjax.loadingMsg), $.ajax({ type: "POST", dataType: "json", url: cherryAjax.ajaxUrl, data: $(".form-register").serialize() + "&action=ajaxRegister", success: function (t) { t.code ? document.location.href = cherryAjax.homeUrl : (console.log("error: ", t), $.toast({ text: t.msg, icon: "error", position: "top-center", hideAfter: 1e4 })) }, error: function (t) { t.msg ? $.toast({ text: t.msg, icon: "error", position: "bottom-center", hideAfter: 1e4 }) : (console.log("error: ", t), $.toast({ text: "错误的请求", icon: "error", position: "top-center", hideAfter: 1e4 })) } }) }) }), $(function () { var r = !1, n = $(".submit-title"); $(document).on("submit", ".form-submit", function (t) { t.preventDefault(); var e = $(this); $.ajax({ type: "POST", dataType: "json", url: cherryAjax.ajaxUrl, data: $(this).serialize() + "&action=postContent", success: function (t) { t.code ? ($.toast({ text: t.msg, icon: "success", position: "bottom-right" }), e[0].reset(), localStorage.removeItem("postTitle"), localStorage.removeItem("postContent")) : $.toast({ text: t.msg, icon: "error", position: "bottom-right" }) }, error: function (t) { $.toast({ text: t, icon: "error", position: "bottom-right" }) } }), console.log($(this).serialize()) }), $(window).on("load", function () { var t = $("#submit-content_ifr"), e = localStorage.getItem("postContent"), o = localStorage.getItem("postTitle"); e && (t.contents().find(".mce-content-body").html(e), n.val(o)), t.contents().find(".mce-content-body").on("keyup", function () { var t = $(this); r || (r = !0, setTimeout(function () { localStorage.setItem("postContent", t.html()), localStorage.setItem("postTitle", n.val()), $.toast({ text: "已经保存为草稿", position: "bottom-right", stack: !1, hideAfter: 300 }), r = !1 }, 2e3)) }) }), $(".form-update-user").on("submit", function (t) { t.preventDefault(), $.ajax({ type: "POST", dataType: "json", url: cherryAjax.ajaxUrl, data: { action: "updateUser", id: $(".form-update-user .user-id").val(), nickname: $(".form-update-user .nickname").val(), email: $(".form-update-user .email").val(), homepage: $(".form-update-user .homepage").val(), description: $(".form-update-user .description").val() }, success: function (t) { t.code ? $.toast({ text: t.msg, icon: "success", position: "up-right" }) : $.toast({ text: t.msg, icon: "error", position: "up-right" }) }, error: function (t) { $.toast({ text: t, icon: "error", position: "up-right" }) } }) }), $(document).on("submit", ".form-avatar", function (t) { t.preventDefault(); var e = new FormData; e.append("avatar", $(".form-avatar .avatar")[0].files[0]), e.append("action", "updateAvatar"), $.ajax({ type: "POST", cache: !1, url: cherryAjax.ajaxUrl, data: e, processData: !1, contentType: !1, success: function (t) { var e = JSON.parse(t); e.code ? ($.toast({ text: "头像更新成功", icon: "success", position: "top-center", hideAfter: 1e3 }), $(".user-avatar img").attr("src", e.extra), $(".header-avatar").attr("src", e.extra), $(".user-avatar-cover").attr("style", "background-image: url(".concat(e.extra, ");"))) : $.toast({ text: e.msg, icon: "error", position: "top-right", hideAfter: 1e3 }) }, error: function (t) { $.toast({ text: t.msg, icon: "error", position: "up-right" }) } }) }) }), $(function () { $(document).on("click", ".btn-upload-thumbnail", function () { var e; e || (e = wp.media({ title: "选择图片", button: { text: "添加为封面图" }, multiple: !1 })).on("select", function () { var t = e.state().get("selection").first().toJSON(); "png" === t.subtype || "jpeg" === t.subtype || "gif" === t.subtype ? ($(".thumbnail-img").attr("src", t.url).removeClass("d-none"), $("input.thumbnail").val(t.id)) : alert("请选择图片！") }), e.open() }) }); var wpieAjaxRequest = function (t, e, o, r) { $.ajax({ type: e, url: t, data: o, dataType: "json", success: function (t) { r(t) }, error: function (t) { console.log("error: ", t) } }) };